/*! bcs-config-migrator - v0.0.1 - 2014-04-08 */var updateDevice=function(a,b){var c=100/b.length,d=a.find(".progress-bar-success")[0],e=a.find(".progress-bar-danger")[0];async.eachLimit(b,2,function(b,f){var g="elem-"+b.endpoint.replace(/\//g,"-");a.append('<div class="row" id="'+g+'"><div class="col-6 col-md-8">Updating '+b.endpoint+" ... </div></div>"),$.post($("#bcs")[0].value+"/api/"+b.endpoint,JSON.stringify(b.data),null,"json").done(function(){a.find("#"+g).append('<div class="col-6 col-md-4 pull-right"><span class="pull-right label label-success">Done</span></div>'),$(d).attr("aria-valuenow",parseFloat($(d).attr("aria-valuenow"))+c),$(d).css("width",$(d).attr("aria-valuenow")+"%"),f()}).fail(function(){a.find("#"+g).append('<div class="col-6 col-md-4 pull-right"><span class="pull-right label label-danger">Failed</span></div>'),$(e).attr("aria-valuenow",parseFloat($(e).attr("aria-valuenow"))+c),$(e).css("width",$(e).attr("aria-valuenow")+"%"),f()})})};$(document).ready(function(){var a,b;$("#bcs").on("change",function(c){$.get(c.target.value+"/api/device",function(d){"4.0.0"===d.version?(a=d.type,localStorage["bcs-backup.url"]=c.target.value,$("#bcs").parent().addClass("has-success").removeClass("has-error"),$("#process").html="",b=[],async.times(8,function(a,d){$.get(c.target.value+"/api/process/"+a,function(c){b.push({id:a,name:c.name}),d()})},function(){b.sort(function(a,b){return a.id-b.id}),b.forEach(function(a){$("#process").append("<option value="+a.id+">"+a.id+" - "+a.name+"</option>")})})):$("#bcs").parent().addClass("has-error").removeClass("has-success")}).fail(function(){$("#bcs").parent().addClass("has-error").removeClass("has-success")})}),$("#configFile").on("change",function(a){a.target.files[0].size?$("#configFile").parent().addClass("has-success").removeClass("has-error"):$("#configFile").parent().addClass("has-error").removeClass("has-success")}),$("form").on("change",function(){$("div.has-success #bcs").length&&$("div.has-success #configFile").length?$("button").removeClass("disabled"):$("button").addClass("disabled")}),$("button").on("click",function(b){b.preventDefault();var c=$("#dialog .modal-body");c.empty(),$("#dialog").modal("show"),Migrator.migrate($("#configFile")[0].files[0],function(b){"unknown"!==b.type?(c.append('<div class="alert alert-success">Found valid <strong>'+b.type+"</strong> configuration.</div>"),b.device!==a&&c.append('<div class="alert alert-warning">Device mismatch.  Loading anyway, may result in errors. <ul><li>Config file version: <strong>'+b.device+"</strong></li><li>Device version: <strong>"+a+"</strong></li></div>"),c.append($("#progress").html()),"process"===b.type?(c.append($("#process-selector").html()),$("#update-process").on("click",function(a){a.preventDefault(),$(a.target).addClass("disabled");var d=c.find("select")[0].value,e=b.config.map(function(a){return a.endpoint=a.endpoint.replace(":id",d),a});updateDevice(c,e)})):updateDevice(c,b.config)):c.append('<div class="alert alert-danger">Invalid configuration file found</div>')})}),localStorage["bcs-backup.url"]&&($("[data-name=bcs]").val(localStorage["bcs-backup.url"]),$("[data-name=bcs]").change())});